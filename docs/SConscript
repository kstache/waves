#! /usr/bin/env python

import os

# Set project global variables
project_name = 'SCons-simulation'
# TODO: recover from Git tags. Probably using Python setuptools_scm.
VERSION='0.1.1+dev'

# Inherit user's full environment and set project variables
env = Environment(ENV=os.environ.copy(), PROJECT_NAME=project_name.lower(), VERSION=VERSION)

# Perform variable substitution on Sphinx configuration file
env.Substfile("conf.py.in", SUBST_DICT={'@PROJECT_NAME@': env['PROJECT_NAME'], '@VERSION@': env['VERSION']})

# Explicit Sphinx documentation dependency list
documentation_file_list = [
    'conf.py',
    'changelog.rst',
    'index.rst',
    'project_brief.txt',
    'references.bib',
    'release_philosophy.rst',
    'targets.txt',
    'model_repository_user.rst',
    'build.txt',
    'documentation.txt',
    'zreferences.rst',
    '_static/custom.css'
]

# TODO: Find the sphinx-build program with scons
# TODO: os agnostic pathsep for the html directory
env.Command(target=['documentation', 'html/index.html'],
            source=documentation_file_list,
            action="sphinx-build -b html ${TARGET.dir.abspath} ${TARGET.dir.abspath}/html")
